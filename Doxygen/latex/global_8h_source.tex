\hypertarget{global_8h_source}{}\doxysection{C\+:/\+Users/omard/\+Desktop/\+Projet\+\_\+\+S4\+\_\+grand\+\_\+final/global.h}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef \_\_OS\_DEFINES\_\_}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define \_\_OS\_DEFINES\_\_}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 }
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <stdio.h>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <stdlib.h>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <assert.h>}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#include <stdbool.h>}}
\DoxyCodeLine{9 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <time.h>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <sys/types.h>}}
\DoxyCodeLine{12 \textcolor{preprocessor}{\#include <sys/stat.h>}}
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include <unistd.h>}}
\DoxyCodeLine{14 }
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{preprocessor}{\#include "{}Sha256/sha256.h"{}}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include "{}Sha256/sha256\_utils.h"{}}}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{comment}{// pour les droits : minuscule = pas le droit, majuscule = droit ok}}
\DoxyCodeLine{20 \textcolor{preprocessor}{\#define rw 0 }\textcolor{comment}{// 00}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#define rW 1 }\textcolor{comment}{// 01}}
\DoxyCodeLine{22 \textcolor{preprocessor}{\#define Rw 2 }\textcolor{comment}{// 10}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#define RW 3 }\textcolor{comment}{// 11}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#define ROOT\_UID 0}}
\DoxyCodeLine{25 }
\DoxyCodeLine{26 \textcolor{preprocessor}{\#define FILENAME\_MAX\_SIZE 32 }\textcolor{comment}{// nb max de caractères des noms de fichiers}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#define MAX\_FILE\_SIZE (2*1024) }\textcolor{comment}{// taille max d'un fichier (uchar)}}
\DoxyCodeLine{28 \textcolor{preprocessor}{\#define INODE\_TABLE\_SIZE 10 }\textcolor{comment}{// taille fixe = nb max de fichiers dans le SE}}
\DoxyCodeLine{29 \textcolor{preprocessor}{\#define MAX\_MSG 1024 }\textcolor{comment}{// uchar}}
\DoxyCodeLine{30 \textcolor{preprocessor}{\#define TIMESTAMP\_SIZE 26 }\textcolor{comment}{// avec \(\backslash\)0 et pour que ça tombe juste avec les blocs}}
\DoxyCodeLine{31 \textcolor{preprocessor}{\#define NB\_USERS 5}}
\DoxyCodeLine{32 }
\DoxyCodeLine{33 \textcolor{preprocessor}{\#define BLOCK\_SIZE 4 }\textcolor{comment}{// octets}}
\DoxyCodeLine{34 \textcolor{preprocessor}{\#define SUPER\_BLOCK\_SIZE 4 }\textcolor{comment}{// nb blocs}}
\DoxyCodeLine{35 \textcolor{preprocessor}{\#define INODES\_START SUPER\_BLOCK\_SIZE*BLOCK\_SIZE+1 }\textcolor{comment}{// en octets}}
\DoxyCodeLine{36 \textcolor{preprocessor}{\#define INODE\_SIZE (FILENAME\_MAX\_SIZE/BLOCK\_SIZE)+6+((TIMESTAMP\_SIZE*2)/BLOCK\_SIZE)}}
\DoxyCodeLine{37 \textcolor{comment}{//= 27 en blocs = 8 blocs de filename+6 uint+timestamps}}
\DoxyCodeLine{38 \textcolor{preprocessor}{\#define USER\_START (INODES\_START) + (INODE\_SIZE)*(INODE\_TABLE\_SIZE)*BLOCK\_SIZE }}
\DoxyCodeLine{39 \textcolor{preprocessor}{\#define USER\_SIZE ((FILENAME\_MAX\_SIZE) + (SHA256\_BLOCK\_SIZE*2 + 1 + 3))/BLOCK\_SIZE}}
\DoxyCodeLine{40 \textcolor{comment}{//= 25 en blocs = 8 blocs de filename + 17 pour le passwd(+3 pour que ça tombe juste)}}
\DoxyCodeLine{41 }
\DoxyCodeLine{42 \textcolor{preprocessor}{\#define FIRST\_FREE\_BYTE (SUPER\_BLOCK\_SIZE*BLOCK\_SIZE)+((INODE\_SIZE)*(INODE\_TABLE\_SIZE)*BLOCK\_SIZE)+((USER\_SIZE)*BLOCK\_SIZE*NB\_USERS) +1}}
\DoxyCodeLine{43 \textcolor{comment}{// Le premier fichier sera écrit au 1597eme octet}}
\DoxyCodeLine{44 }
\DoxyCodeLine{45 }
\DoxyCodeLine{46 }
\DoxyCodeLine{47 \textcolor{preprocessor}{\#define OUVERTURE\_ERR 1}}
\DoxyCodeLine{48 \textcolor{preprocessor}{\#define ECRITURE\_ERR 2}}
\DoxyCodeLine{49 \textcolor{preprocessor}{\#define FERMETURE\_ERR 3}}
\DoxyCodeLine{50 \textcolor{preprocessor}{\#define LECTURE\_ERR 4}}
\DoxyCodeLine{51 \textcolor{preprocessor}{\#define FULL\_ERR 5}}
\DoxyCodeLine{52 \textcolor{preprocessor}{\#define POS\_END 6}}
\DoxyCodeLine{53 \textcolor{preprocessor}{\#define POS\_BIG 7}}
\DoxyCodeLine{54 \textcolor{preprocessor}{\#define SIZE\_FILE\_ERR 8}}
\DoxyCodeLine{55 \textcolor{preprocessor}{\#define CREATION\_ERR 9}}
\DoxyCodeLine{56 \textcolor{preprocessor}{\#define COMMAND\_ERR 10}}
\DoxyCodeLine{57 \textcolor{preprocessor}{\#define ARG\_ERR -\/1}}
\DoxyCodeLine{58 }
\DoxyCodeLine{59 }
\DoxyCodeLine{60 }
\DoxyCodeLine{61 \textcolor{keyword}{typedef} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} uint; \textcolor{comment}{// même taille que int}}
\DoxyCodeLine{62 \textcolor{keyword}{typedef} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{char} uchar; \textcolor{comment}{// 8 bits non signés = octet}}
\DoxyCodeLine{63 }
\DoxyCodeLine{64 \textcolor{preprocessor}{\#define RED "{}\(\backslash\)x1B[31m"{}}}
\DoxyCodeLine{65 \textcolor{preprocessor}{\#define NRM "{}\(\backslash\)x1B[0m"{}}}
\DoxyCodeLine{66 \textcolor{preprocessor}{\#define GRN  "{}\(\backslash\)x1B[32m"{}}}
\DoxyCodeLine{67 }
\DoxyCodeLine{68 }
\DoxyCodeLine{69 \textcolor{comment}{// structure pour la table des utilisateurs}}
\DoxyCodeLine{70 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structuser__s}{user\_s}}\{}
\DoxyCodeLine{71   \textcolor{keywordtype}{char} login[FILENAME\_MAX\_SIZE];}
\DoxyCodeLine{72   \textcolor{keywordtype}{char} passwd[SHA256\_BLOCK\_SIZE*2 + 1]; \textcolor{comment}{// 64 hex char = haché du passwd}}
\DoxyCodeLine{73 \} \mbox{\hyperlink{structuser__s}{user\_t}};}
\DoxyCodeLine{74 }
\DoxyCodeLine{75 \textcolor{comment}{// pour gérer l'uid tout le long de la session}}
\DoxyCodeLine{76 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structsession__s}{session\_s}}\{}
\DoxyCodeLine{77   \textcolor{keywordtype}{int} userid;}
\DoxyCodeLine{78 \} \mbox{\hyperlink{structsession__s}{session\_t}};}
\DoxyCodeLine{79 }
\DoxyCodeLine{80 \textcolor{comment}{/* Type of a block of data */}}
\DoxyCodeLine{81 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structblock__s}{block\_s}}\{}
\DoxyCodeLine{82     uchar data[BLOCK\_SIZE]; \textcolor{comment}{// une case par octet}}
\DoxyCodeLine{83 \} \mbox{\hyperlink{structblock__s}{block\_t}};}
\DoxyCodeLine{84 }
\DoxyCodeLine{85 \textcolor{comment}{/* Type of the pseudo-\/inode structure */}}
\DoxyCodeLine{86 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structinode__s}{inode\_s}}\{}
\DoxyCodeLine{87   \textcolor{comment}{// type file vs dir}}
\DoxyCodeLine{88   \textcolor{keywordtype}{char} filename[FILENAME\_MAX\_SIZE]; \textcolor{comment}{// dont '\(\backslash\)0'}}
\DoxyCodeLine{89   uint size; \textcolor{comment}{// du fichier en octets}}
\DoxyCodeLine{90   uint uid; \textcolor{comment}{//user id proprio}}
\DoxyCodeLine{91   uint uright; \textcolor{comment}{//owner's rights between 0 and 3 coding rw in binary}}
\DoxyCodeLine{92   uint oright; \textcolor{comment}{// other's right idem}}
\DoxyCodeLine{93   \textcolor{keywordtype}{char} ctimestamp[TIMESTAMP\_SIZE]; \textcolor{comment}{// date creation : 26 octets}}
\DoxyCodeLine{94   \textcolor{keywordtype}{char} mtimestamp[TIMESTAMP\_SIZE]; \textcolor{comment}{// date dernière modif. : 26 octets}}
\DoxyCodeLine{95   uint nblock; \textcolor{comment}{// nblock du fichier = (size+BLOCK\_SIZE-\/1)/BLOCK\_SIZE ?}}
\DoxyCodeLine{96   uint first\_byte; \textcolor{comment}{// number of the first byte on the virtual disk}}
\DoxyCodeLine{97 \} \mbox{\hyperlink{structinode__s}{inode\_t}};}
\DoxyCodeLine{98 }
\DoxyCodeLine{99 \textcolor{comment}{/* Type of the inode table */}}
\DoxyCodeLine{100 \textcolor{keyword}{typedef} \mbox{\hyperlink{structinode__s}{inode\_t}} inode\_table\_t[INODE\_TABLE\_SIZE];\textcolor{comment}{// la taille est fixe}}
\DoxyCodeLine{101 \textcolor{keyword}{typedef} \mbox{\hyperlink{structuser__s}{user\_t}} users\_table\_t[NB\_USERS]; \textcolor{comment}{// taille fixe. L'indice est l'uid.}}
\DoxyCodeLine{102 }
\DoxyCodeLine{103 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structsuper__block__s}{super\_block\_s}}\{}
\DoxyCodeLine{104   uint number\_of\_files; \textcolor{comment}{// dans super bloc}}
\DoxyCodeLine{105   uint number\_of\_users; \textcolor{comment}{// idem}}
\DoxyCodeLine{106   uint nb\_blocks\_used ; \textcolor{comment}{//}}
\DoxyCodeLine{107   uint first\_free\_byte; \textcolor{comment}{// premier octet libre}}
\DoxyCodeLine{108   \} \mbox{\hyperlink{structsuper__block__s}{super\_block\_t}};}
\DoxyCodeLine{109 }
\DoxyCodeLine{110 \textcolor{comment}{/* Type of the virtual disk system */}}
\DoxyCodeLine{111 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structvirtual__disk__s}{virtual\_disk\_s}} \{}
\DoxyCodeLine{112     \mbox{\hyperlink{structsuper__block__s}{super\_block\_t}} super\_block;}
\DoxyCodeLine{113     users\_table\_t users\_table[NB\_USERS]; \textcolor{comment}{// tableau}}
\DoxyCodeLine{114     inode\_table\_t inodes[INODE\_TABLE\_SIZE];\textcolor{comment}{// tableau}}
\DoxyCodeLine{115     FILE *storage; \textcolor{comment}{//fichier vdisk du système de fichiers}}
\DoxyCodeLine{116 \} \mbox{\hyperlink{structvirtual__disk__s}{virtual\_disk\_t}};}
\DoxyCodeLine{117 }
\DoxyCodeLine{118 \textcolor{comment}{// structure pour les fichiers}}
\DoxyCodeLine{119 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structfile__s}{file\_s}}\{}
\DoxyCodeLine{120   uint size; \textcolor{comment}{// Size of file in bytes with pading ie compléter le dernier bloc avec des zéros}}
\DoxyCodeLine{121   uchar data [MAX\_FILE\_SIZE] ; \textcolor{comment}{// only text files}}
\DoxyCodeLine{122 \} \mbox{\hyperlink{structfile__s}{file\_t}} ;}
\DoxyCodeLine{123 }
\DoxyCodeLine{124 \textcolor{comment}{// structure pour gérer les commandes de l'interprète}}
\DoxyCodeLine{125 \textcolor{keyword}{typedef} \textcolor{keyword}{struct }\mbox{\hyperlink{structcmd__s}{cmd\_s}}\{}
\DoxyCodeLine{126     \textcolor{keywordtype}{char} ** tabArgs; \textcolor{comment}{// tableau des arguments}}
\DoxyCodeLine{127     \textcolor{keywordtype}{int} nbArgs; \textcolor{comment}{// nombre d'arguments}}
\DoxyCodeLine{128 \} \mbox{\hyperlink{structcmd__s}{cmd\_t}};}
\DoxyCodeLine{129 }
\DoxyCodeLine{130 \textcolor{preprocessor}{\#endif }\textcolor{comment}{// \_\_OS\_DEFINES\_\_}}

\end{DoxyCode}
